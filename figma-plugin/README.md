# Figma Plugin - –ò–∑–∏ –¢–µ—Å—Ç

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–Ω–±–æ—Ä–¥–∏–Ω–≥)

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω:** Plugins ‚Üí –ò–∑–∏ –¢–µ—Å—Ç
2. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - **Supabase URL** ‚Äî URL –≤–∞—à–µ–≥–æ Supabase (Cloud –∏–ª–∏ self-hosted, –Ω–∞–ø—Ä–∏–º–µ—Ä `https://xxxxx.supabase.co`)
   - **Supabase Anon Key** ‚Äî anon-–∫–ª—é—á –∏–∑ Supabase (Settings ‚Üí API)
   - **Viewer URL** ‚Äî URL viewer (–ª–æ–∫–∞–ª—å–Ω–æ: `http://localhost:5173`; production: `https://viewer.–≤–∞—à-–¥–æ–º–µ–Ω.ru`)
   - **Analytics URL** ‚Äî URL –ø–∞–Ω–µ–ª–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ: `http://localhost:5174`; production: `https://analytics.–≤–∞—à-–¥–æ–º–µ–Ω.ru`)
   - **Figma Personal Access Token** ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è Figma REST API (Figma Settings ‚Üí Account ‚Üí Personal Access Tokens)
3. **–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"**
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö

### –ì–¥–µ –Ω–∞–π—Ç–∏ –∫–ª—é—á–∏ Supabase?

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://app.supabase.com)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí API**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Project URL** ‚Üí –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "Supabase URL"
   - **anon/public key** ‚Üí –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "Supabase Anon Key"

---

## üìã –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é, –æ—Ç–∫—Ä–æ–π—Ç–µ `figma-plugin/code.js` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –æ–±—ä–µ–∫—Ç `CONFIG`:

```javascript
const CONFIG = {
  SUPABASE_URL: "https://your-project.supabase.co",
  SUPABASE_ANON_KEY: "your-anon-key-here",
  VIEWER_URL: "http://localhost:5173",
  ANALYTICS_URL: "http://localhost:5174"
};
```
(Figma Personal Access Token –∑–∞–¥–∞—ë—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–ª–∞–≥–∏–Ω–∞.)

**–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ `figma-viewer/.env`:
- `VITE_SUPABASE_URL` ‚Üí `CONFIG.SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY` ‚Üí `CONFIG.SUPABASE_ANON_KEY`

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–ª—è —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç–æ–≤ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤)

1. –†–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø
2. –í –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ email** (OTP –∫–æ–¥)
3. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –í—Å–µ —Å–æ–±—ã—Ç–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Supabase —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –î–ª—è –¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤)

- –ü–ª–∞–≥–∏–Ω —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã **–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** (–ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã)
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ viewer
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase —Ä–∞–∑—Ä–µ—à–∞—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤ –±–µ–∑ `user_id`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–ª–∞–≥–∏–Ω–∞
3. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Figma Desktop
2. Plugins ‚Üí Development ‚Üí Import plugin from manifest...
3. –í—ã–±–µ—Ä–∏—Ç–µ `figma-plugin/manifest.json`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è
1. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω –≤ Figma Community
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ Plugins ‚Üí Browse plugins

---

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–°–æ–∑–¥–∞–π—Ç–µ –º–∞–∫–µ—Ç—ã –≤ Figma** —Å –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞–º–∏ –∏ —Ö–æ—Ç—Å–ø–æ—Ç–∞–º–∏
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–∞–≥–∏–Ω:** Plugins ‚Üí –ò–∑–∏ –¢–µ—Å—Ç
3. **–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Ç–µ—Å—Ç"** (–ø–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç JSON)
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É** –¥–ª—è —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç–∞
5. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Ä–µ—Å–ø–æ–Ω–¥–µ–Ω—Ç—É** ‚Äî –æ–Ω –æ—Ç–∫—Ä–æ–µ—Ç –µ—ë –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∏ –Ω–∞—á–Ω–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

- **–°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω:** –í—ã–¥–µ–ª–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ñ—Ä–µ–π–º –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ `[start]` –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ
- **–§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω:** –î–æ–±–∞–≤—å—Ç–µ `[final]` –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **–•–æ—Ç—Å–ø–æ—Ç—ã:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Figma Prototype –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `figma.clientStorage` (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–ª–∞–≥–∏–Ω–∞)
- **–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö:** `postMessage` –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É `code.js` –∏ `ui.html`
- **–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã:** –°–æ–∑–¥–∞—é—Ç—Å—è –≤ Supabase –±–µ–∑ `user_id` (–ø—É–±–ª–∏—á–Ω—ã–µ), –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–°–µ—Å—Å–∏–∏:** –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø –≤ viewer

### –î–ª—è production

–ü—Ä–∏ –¥–µ–ø–ª–æ–µ viewer'–∞ –Ω–∞ production:
1. –û–±–Ω–æ–≤–∏—Ç–µ `VIEWER_URL` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–ª–∞–≥–∏–Ω–∞ –Ω–∞ production URL
2. CORS –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ Supabase (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

- **–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã** (`prototypes`): –•—Ä–∞–Ω—è—Ç JSON –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞, –º–æ–≥—É—Ç –±—ã—Ç—å –±–µ–∑ `user_id`
- **–°–µ—Å—Å–∏–∏** (`sessions`): –°–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞, –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `user_id` —á–µ—Ä–µ–∑ RLS
- **–°–æ–±—ã—Ç–∏—è** (`events`): –ó–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–µ—Å—Å–∏–∏ –∏ `user_id`

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–æ–≤ —Å viewer

–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —ç–∫—Ä–∞–Ω–æ–≤ –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ –ø–ª–∞–≥–∏–Ω–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Å —Ñ–æ—Ä–º–∞—Ç–æ–º Figma Embed (`figmaNodeId`, —Ñ–æ—Ä–º–∞—Ç `pageId:nodeId`): `screen.id`, `scene.id`, `hotspot.frame`, `edge.from`/`edge.to`, `output.start`/`output.end` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫—Ä–∞–Ω–∞ –≤ viewer –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ `PRESENTED_NODE_CHANGED`.

